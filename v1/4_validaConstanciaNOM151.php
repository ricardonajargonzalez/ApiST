<?php
header('Content-type: application/xml');

$soapURL = "https://pilot-psc.reachcore.com/wsnom_validacion/webservice.asmx?op=validaNOM151";

$usuario = "Oswaldo Ramos Luna";
$Clave = "50V052022*";
$Entidad = "THINK SMART";
$nombreArchivoOriginal = 'prueba123.pdf';
$huellaDigitalArchivo = 'RjUxMTIzNUFDRTYxRTAxRDA5ODE3MTFEQUZERTEzODMxOUNGMDM0RjRGNzg4NDQyOTQ3QjMyMkUxNjA0QTczQw==';


$constancia = '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';



$xml_post_string = '<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Header>
    <AuthSoapHd xmlns="http://tempuri.org/">
      <Entidad>'.$Entidad.'</Entidad>
      <Usuario>'.$usuario.'</Usuario>
      <Clave>'.$Clave.'</Clave>
    </AuthSoapHd>
  </soap:Header>
  <soap:Body>
    <validaNOM151 xmlns="http://tempuri.org/">
      <nombreArchivoOriginal>'.$nombreArchivoOriginal.'</nombreArchivoOriginal>
      <huellaDigitalArchivo>'.$huellaDigitalArchivo.'</huellaDigitalArchivo>
      <constancia>'.$constancia.'</constancia>
    </validaNOM151>
  </soap:Body>
</soap:Envelope>';


$headers = array(
   "Content-type: text/xml;charset=\"utf-8\"",
   "Accept: text/xml",
   "Cache-Control: no-cache",
   "Pragma: no-cache",
   "SoapAction: http://tempuri.org/validaNOM151",
   "Content-length: ". strlen($xml_post_string),
);

$url = $soapURL;

$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl,CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl,CURLOPT_USERPWD, $usuario . ":" . $Clave);

curl_setopt($curl,CURLOPT_HTTPAUTH,CURLAUTH_ANY);
curl_setopt($curl,CURLOPT_TIMEOUT,30);
curl_setopt($curl,CURLOPT_POST,true);
curl_setopt($curl,CURLOPT_POSTFIELDS, $xml_post_string);

curl_setopt($curl,CURLOPT_HTTPHEADER, $headers);

$response = curl_exec($curl);
curl_close($curl);


$xml = $response;
echo $xml;

?>